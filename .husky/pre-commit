echo "ğŸ” Running pre-commit checks..."

echo "\nğŸ“ Formatting code..."
pnpm format

echo "\nğŸ“Š Generating dependency graphs..."
pnpm deps:graph

echo "\nğŸ”„ Checking for circular dependencies..."
pnpm circular:check || {
  echo "âŒ Circular dependencies detected."
  exit 1
}

echo "\nğŸ“ˆ Generating code quality metrics..."
pnpm deps:metrics || {
  echo "âŒ Critical code quality violations detected."
  exit 1
}

echo "\nğŸ”— Checking for high coupling..."
pnpm deps:check-coupling || {
  echo "âš ï¸  Warning: High coupling detected (see above)"
  # Don't exit - this is a warning only
}

echo "\nâ• Staging dependency graphs and metrics..."
git add docs/dependencies/*-deps.json docs/dependencies/*-metrics.json

echo "\nğŸ” Running linter..."
pnpm lint || {
  echo "âŒ Linting failed. Fix the issues above."
  exit 1
}

echo "\nğŸ”§ Running type checks..."
pnpm type-check || {
  echo "âŒ Type check failed. Fix the type errors above."
  exit 1
}

echo "\nğŸ§ª Running tests with coverage..."
pnpm test:coverage || {
  echo "âŒ Tests failed. Fix the failing tests above."
  exit 1
}

echo "\nğŸ—ï¸  Building project..."
pnpm build || {
  echo "âŒ Build failed. Fix the build errors above."
  exit 1
}

echo "\nâœ… All pre-commit checks passed!"
